已经有大量关于分形的著作，其中包括1982年那本引发热潮的著名书籍：贝努瓦·曼德尔布罗特（Benoït Mandelbrot）所著的《大自然的分形几何学》（*The Fractal Geometry of Nature*），正是这位数学家在20世纪70年代创造了“分形”这一术语。本章仅对这个广泛的主题进行简要介绍，以便为后续章节中介绍的一些技巧提供思路。本书第二部分将更全面地探讨分形，因为它们在创建对象方面更有用。 

## 什么是分形？

分形是一种具有“跨所有尺度的自相似性”的函数，如果我们不能恰当地解释它，这个定义就没什么用。简单地说，分形是一种在任何局部区域都具有相同变化类型的函数，无论缩放级别如何。

![2505055201 ](https://blogimgbeg.oss-cn-shanghai.aliyuncs.com/2025/05/05/1mg/2505055201-.png)

*A fractal function sampled at increasing resolution. Note that the range of
values shrinks at about the same rate as the size of the interval.*


###  现实生活中的分形
我们周围世界中的许多物体和现象在各种尺度上都呈现出分形外观：海岸线、海浪、河流、山脉、云层、纸张（当你近距离观察时）、树木和植物，甚至我们的肺部以及我们身体内的血管网络。这些事物都是以分层的方式形成的，较小的特征由较大的特征衍生而来。生物结构是生长而成的，而无生命的分形物体通常是由流体介质中的湍流形成的。这里的“流体”指的是“非固体”—— 可以是气体或液体。大致说来，湍流的产生是因为流体中的某种扰动引发了漩涡，较大的漩涡在其周边产生相反方向的较小漩涡。这个过程会持续产生越来越小的漩涡。 ，直到它们太小且能量太弱，无法让这个过程继续下去。固体也可能因湍流而塑形，要么是在它们形成的时候（比如由熔岩形成的岩石），要么是因为它们受到风和水的侵蚀作用，而侵蚀是由固体表面的湍流流动造成的。

实际上，现实生活中所有 “分形” 物体在数学意义上都并非真正的分形，因为对它们进行放大观察时，在它们失去自相似性之前，放大的程度是有限的。树木有多个层次，从较大的树枝上长出较小的树枝，但最终分枝会停止，最小的细枝上会长出叶子。叶子在某种程度上也具有分形特征，但树木的细节并非无穷无尽。海岸线越靠近观察就越显得参差不齐，但当你真正近距离放大观察时，即使是在特别多岩石的部分，在某个尺度下它看起来就不再粗糙，而更像是一条直线。你可以构造一个人为的例子，比如放大观察单个沙粒，并把它们的表面当作 “海岸线” 来计算（尽管这有点牵强地延伸了这个词的定义），但沙粒具有晶体结构，其表面大多是平坦的小面，这使得地形的分形特征至少在微观层面上不再成立。自然界中的 “分形” 物体可以在很宽的尺度范围内表现出自相似性，但不会在无穷的尺度范围内都如此。由于粘性的存在，湍流现象在尺寸上有一个截止值，粘性对于气体也是存在的，尽管对于液体来说粘性要强大几个数量级。粘性对湍流的影响是非线性的 —— 它对小漩涡的抑制作用按比例更强。

自然界中类似分形的物体在数学意义上并非分形这一事实意味着它们并不具有无穷的复杂性，这对我们用计算机图形学来对它们的形状和外观进行建模来说是件幸事。此外，在计算机图形学中，我们关注的是物体的外观，而不一定是它们是如何形成、构建或生长的，如果我们不对某个物体进行非常近距离的放大观察，就无需对它的细微细节进行建模。很少有必要去关注那些在渲染输出中明显小于一个像素的几何细节。为了对表面反射属性进行建模，我们可以很好地利用关于小至亚微米尺度细节的统计信息，但我们无需知道每个点的确切形状。

### 分形维数
分形是奇特的数学曲线和曲面，可以用它们的分形维数来描述其特征。我们在这里不会给出分形维数的正式定义，但对于一条曲线在某种程度上具有大于一维的性质，或者一个曲面具有大于二维的性质这样的概念，至少需要一个直观的解释。 

![2505055527 ](https://blogimgbeg.oss-cn-shanghai.aliyuncs.com/2025/05/05/1mg/2505055527-.png)
*Some real life objects with fractal properties. There are countless other examples.*

一个相当简单的示例用到了雪花分形，它也被称为 “科赫曲线”，得名于瑞典数学家黑尔格·冯·科赫（Helge von Koch），他于 1904 年首次提出了这一概念。它是以递归的方式定义的，每一步都是将线段明确地细分为一系列更短的线段。这个序列从一个三角形开始，最终形成类似雪花的形状：

![2505050001 ](https://blogimgbeg.oss-cn-shanghai.aliyuncs.com/2025/05/05/1mg/2505050001-.png)
*构建科赫 “雪花” 分形。除非你近距离放大观察，否则最后几次迭代看起来是一样的。打印输出可能无法呈现出那些细线条。*


现在，如果我们大胆设想将这个变换执行无数次，那么极限曲线（“在” 无数次迭代 “之后”）会具有一些非常奇特的性质。它在任何地方都是连续的，因为它从一条连续曲线开始，而且在此过程中的任何步骤都不会破坏这种连续性。然而，它在任何地方都不可微，因为在曲线的任何区间内都有无数个尖锐的角。它所围成的面积是有限的，因为它在范围上是有边界的，但它的长度是无限的，因为每进行一次迭代，曲线的长度就会增加$4/3$。在第N次迭代时，曲线的长度是原始线段长度的$(4/3)^N$倍，当N趋于无穷大时，这个长度也趋于无穷大。面积也随着每一步迭代而增加，但它有一个极限值。
分形维数的概念可以通过用直径逐渐减小的圆覆盖曲线，并计算随着圆逐渐变小所需圆的数量，来直观地解释（仍然是正确的，只是不那么形式化）。为了进行比较，我们也对一条直线和一个正方形做同样的操作。

![2505050134 ](https://blogimgbeg.oss-cn-shanghai.aliyuncs.com/2025/05/05/1mg/2505050134-.png)
*用圆覆盖物体。左图：科赫曲线。中图：直线。右图：正方形*


当我们将圆的大小缩放为原来的$1/3$时，覆盖科赫曲线需要的圆的数量是原来的4倍。覆盖一条直线只需要原来3倍数量的圆。对于覆盖一个正方形的圆来说，我们需要3×3 = 9倍数量的圆。从某种程度上来说，科赫曲线介于两者之间。 另外它们缩放比例的倒数。对于直线，其值为$\ln 3 / \ln 3 = 1$，对于正方形，其值为$\ln 9 / \ln 3 = 2$，这两个结果都符合常理。对于科赫曲线，其值为$\ln 4 / \ln 3 \approx 1.26186$，这可能不太好理解，但它与该曲线 “略大于一维，但又不到二维” 的性质是相符的。

### 曼德博集合
关于分形的章节确实不能不提到标志性的曼德博集合，它以贝努瓦·曼德博（Benoït Mandelbrot）的名字命名。实际上，曼德博集合不是他发现的，而是由罗伯特·W·布鲁克斯（Robert W. Brooks）和彼得·马泰尔斯基（Peter Matelski）在1978年发表的，但曼德博在1980年通过用令人印象深刻（在当时）的计算机图形对其进行可视化展示，使其声名远扬。

该算法在复平面$z = x + iy$中，通过一个看似简单的复数序列递归公式来定义：
$$
z_i = z_{i - 1}^2 + z_0
$$
曼德博集合是复平面中$z_0$的一个区域，在这个区域内$z_i$的模保持有界，也就是说它不会发散并趋于无穷大。所有$\vert z_0 \vert > 2$的点都会发散，但在这个圆内部会发生一些有趣且奇特的现象。对于该集合的某些部分，可以从形式上证明其不会发散，但对于可视化来说，通常运行相当多的迭代次数，并将那些尚未导致$\vert z_i \vert$急剧增大的初始值$z_0$视为可能（“大概”）属于该集合的部分就足够了。下面展示的是曼德博集合首次发表的图像，是用一台仅能打印字符的打印机制作的。

![2505050459 ](https://blogimgbeg.oss-cn-shanghai.aliyuncs.com/2025/05/05/1mg/2505050459-.png)
*这是布鲁克斯和马泰尔斯基在1978年可视化的曼德博集合。*

对于现代的可视化目的，通过计算在$\vert z_i \vert$超过2之前所进行的迭代次数来描述集合外部的点也是很有用的，因为在$\vert z_i \vert$超过2之后就可以确定会发散。这个算法在一定程度上很适合在着色器中实现， 因为每个点都是通过一个简单的算法独立于其他所有点进行计算的。为了评估曼德博集合放大视图的更精细细节，可能需要进行大量的迭代运算，并且对于极高倍数的放大，需要比单精度浮点数（float）更高精度的算术运算，如果你想进行更极致的放大，甚至需要比双精度浮点数（double）更高的精度。但只要你处于精度所允许的范围内，现代的图形处理器（GPU）实际上是能够实时处理这些计算的。 

![2505050608 ](https://blogimgbeg.oss-cn-shanghai.aliyuncs.com/2025/05/05/1mg/2505050608-.png)
*The Mandelbrot set, visualized by a GPU shader. Points in or near the set required
hundreds of iterations, and 4×4 multisampling was used for antialiasing. Still, a
modern desktop GPU can render this full-screen at an interactive frame rate.*


## 控制混沌
诸如Mandelbrot set（还有许多其他的）这样的数学分形很有趣，但在大多数情况下，它们对于创建纹理并不是特别有用。自相似性使得分形在任何地方、任何尺度下看起来都非常相似。虽然从形式意义上讲存在无限的变化，但从视觉角度来看并没有那么多变化。例如，对曼德勃罗分形的任何使用都必然会展现出其极易辨认的特征。下面的图片，在地形生成程序中用它来创建一条河流，这是个书呆子式的玩笑。这绝对不是坏事，恰恰相反，但它并不是一个可信的自然场景。 

试图让一个数学分形按照你的意愿呈现，有点像赶猫——既令人沮丧，又徒劳无功，而且从根本上来说就是错误的方法。更糟糕的是，真正分形的无限且清晰的细节让抗锯齿处理变得棘手。它通常需要多重采样，而这在计算上成本高昂。 

实际上，真正的分形函数所产生的数学意义上的混沌并非我们真正想要的。我们希望至少能对图案有一定的掌控。因此，本着计算机图形学的精髓，我们将采用取巧的办法，营造出混沌的表象。 

![2505050751 ](https://blogimgbeg.oss-cn-shanghai.aliyuncs.com/2025/05/05/1mg/2505050751-.png)
*“Mandelbrot River” by Alexis Monnerot-Dumaine, username “Prokofiev” on
Wikipedia. CC BY-SA 3.0 (http://creativecommons.org/licenses/by-sa/3.0/)*

## 伪造分形 Faking a fractal

尽管“分形”这一术语是1975年才创造出来的，但数学分形是一个古老得多的概念，而类似分形的事物也早已有之，只是名称不同。一个早期的例子是中点位移算法，它至今仍可用于几何图形的程序生成。Norbert Wiener在20世纪20年代就将其作为对布朗运动（即微观固体粒子在气体或液体中看似不规则、忽动忽停的运动）开创性分析的一部分进行了描述。粒子的运动源于它们与周围介质中因热而不断运动的单个原子或分子之间的碰撞。即使在室温下，这种运动也相当剧烈。 

因为它是由离散的碰撞事件引起的，布朗运动存在一个最小尺度，在这个尺度下，可以看到粒子沿直线运动，每次碰撞时速度和方向都会发生突变，所以它并非具有无限复杂性的实际分形。然而，从那个最小尺度往上，粒子的路径具有分形特性，比如自相似性和非整数分形维数。对这样的路径进行建模，可以通过模拟维纳过程（以Norbert Wiener命名）及其无数次随机碰撞来实现，但同样类型的曲线也可以通过选取一个起点和一个终点，在它们之间画一条直线，然后递归地细分该直线，并使中点相对于原始直线产生随机位移来构建。递归细分需要以一种非常特定的方式进行，才能得到与布朗运动具有完全相同统计特性的曲线，但如果我们想要的只是布朗运动的大致视觉效果，那么我们对这些细节就可以不那么挑剔。

事实上，改变细分区间之间位移平均幅度的变化方式，可以得到一些函数，这些函数虽然不能模拟物理布朗运动，但本身可能非常有用。这类函数甚至有自己的名称：分数布朗运动，历史上称为“fBm”，但现在大多用大写字母表示为：FBM。大多数人甚至不在乎这个名字的由来，但现在你知道了。另请注意，这里的“F”代表“分数的（fractional）”，而不是“分形的（fractal）”。常规的、非分数的布朗运动本质上也是分形的。 

> 译者注： 原来如此，我看到 FBM的时候也在想这个和分型有什么关系。


![2505051223 ](https://blogimgbeg.oss-cn-shanghai.aliyuncs.com/2025/05/05/1mg/2505051223-.png)
*Random midpoint displacement of a line, in several recursive iterations.*

在计算机图形学中，中点位移算法可以扩展到二维，以生成相当逼真的地形，以及一些有趣的图像。在20世纪90年代的计算机图形学演示中，这些图像被戏称为“等离子云”。有时它们仍被称为“等离子分形”。每当达到所需的细节级别时，就可以终止递归细分。对于图像生成来说，当我们以选定的分辨率生成了所有像素时，就达到了该级别；对于地形生成而言，当生成的细节足够小，以至于进一步细分不会对渲染图像产生任何明显影响，或者继续细分会花费太多处理时间时，就可以终止。对于交互式渲染，我们还需要考虑当前输出设备在所需帧率下能够渲染多少数据，并在生成过多数据之前停止。 无需深入探讨算法细节，下页的图展示了二维随机中点位移法的两个结果。一个是通过位移多边形网格生成类似地形的物体，另一个是在图像中生成像素。

![2505051301 ](https://blogimgbeg.oss-cn-shanghai.aliyuncs.com/2025/05/05/1mg/2505051301-.png)
*The result from a 2-D midpoint displacement algorithm. The mesh plot
and the grayscale image show the same data, only displayed differently.*

因为本次演示是关于程序纹理，所以我们将重点关注图像。本书第二部分将介绍使用此技术对多边形网格进行置换，该部分重点介绍程序建模。

不幸的是，中点位移算法对着色器不太友好。为了计算最终分辨率下的单个数据点，我们通常需要为大量其他点计算所有先前的迭代。我们不需要计算所有点就能知道某一点的结果，但通常需要计算相当多的点。可以在不预先计算和存储最终结果的情况下在着色器中执行此操作，但这涉及大量重复工作。中点位移算法的基本结构使其 “倾向于” 一次性计算整个数据集并存储起来以供后续使用。虽然这当然是一种选择（预先计算但通过程序生成的纹理图像也能很好地工作），但我们也希望有一种 “纯粹” 的程序方法—— 一种在不预先计算任何内容的情况下，以合理高效的方式创建相同类型图案的方法。 

为此，我们采用加法频率合成法，这是一种生成具有任意所需频率成分（通常称为频谱特性）信号的有效方法。出于效率考虑，这通常通过傅里叶变换方法来实现，但这也需要预先计算整个图像。相反，我们采用一种 “回归基础” 的方法，将所需频率范围内的各个正弦分量相加。我们从某个基频开始，该基频代表我们想要生成的最大特征，然后继续添加更多项，直到得到我们想要的信号类型。在一维情况下，这可能看起来像下一页的图表。 

![2505051433 ](https://blogimgbeg.oss-cn-shanghai.aliyuncs.com/2025/05/05/1mg/2505051433-.png)
*Direct frequency synthesis by adding many sinusoidal terms of
random phase, with different frequencies covering 1 to 5 octaves.*

上述说明文字中使用的术语“一个倍频程”借自音乐领域，指的是从f到2f的频率范围。当我们纳入足够多倍频程的频率时，曲线就开始呈现出分形的样子。从数学角度而言，如果我们假设能够对跨越无穷频率范围的无穷多项进行求和，那么极限曲线确实是一种分形。此处的优势在于，与实际的分形不同，我们完全能够控制生成的细节精细程度。如果要对信号进行采样，当达到Nyquist极限时，我们就可以停止添加项——即可以进行频率限制。这在实际的分形中是无法实现的，但我们的伪分形却使其变得具体且极为简单。 
这看起来很有希望，所以让我们把它扩展到二维！二维的正弦波和一维的情况一样，都有频率和相位，但还有一个方向，所以为了让图案看起来随机，我们需要让这些项具有随机的相位和方向。
![2505051551 ](https://blogimgbeg.oss-cn-shanghai.aliyuncs.com/2025/05/05/1mg/2505051551-.png)
*Direct frequency synthesis in 2-D by adding sinusoidal terms within one octave,
having random phase and direction. Left to right: 1, 2, 5, 10, 20 and 50 terms.*

如果项数太少，图案就会不均匀，并且会出现由我们用简单正弦条纹构建图案这一事实所导致的瑕疵。直到我们使用几十项，这些瑕疵才会消失。为每个渲染像素添加大约50项，每项调用一次正弦函数，仅仅为了得到一个模糊的、朦胧的图像，这听起来可能很愚蠢，而且对于大多数实际用途来说确实很愚蠢。然而，它为我们指明了想要的方向。一个八度音阶的项之和可能看起来并不起眼，实际上它看起来也不特别像什么，但它是一种非常有用的带限图案。其最大特征的大小由总和中的最低频率决定，最小特征则由最高频率决定。此外，我们可以单独控制每个分量的振幅，使较高频率的振幅逐渐降低。这模仿了递归中点位移法中随机位移振幅的衰减，通过在几个八度音阶上添加项，我们可以创建出看起来像 “等离子云” 的图像。 

![2505051645 ](https://blogimgbeg.oss-cn-shanghai.aliyuncs.com/2025/05/05/1mg/2505051645-.png)
*Adding sinusoidal terms within several octaves. Left to right: 1, 2, 3, 4, 6 and 10
octaves. The rightmost image required 500 terms in total – 50 for each octave*

上图中最右侧的图像看起来与随机中点位移法的结果很相似，但有一个重要区别：它们缺少低频成分，这意味着它们没有大的特征。如果我们愿意，可以通过在总和的低频端加入更多的倍频带来添加这些低频成分，但我们并非必须这么做。我们这里得到的是一种可控的伪分形，它具有明确的特征尺寸（其最低频率）和可控的 “颗粒度”（其最高频率以及频率增加时振幅的衰减）。这为创建程序化纹理提供了很好的基础。

上面那些模糊的斑点图案，也就是仅在一个倍频程中有组成部分的图案，看起来与 “柏林噪声” 非常相似，这将是接下来两章的主题。与使用数百个正弦函数调用来渲染图案不同，柏林噪声的计算要容易得多，并且可以常规地用作给表面添加纹理的工具，甚至在实时应用程序中，甚至在廉价的低功耗图形处理器（GPU）上也能使用。 

然而，首先我们还有一件有趣的事要尝试，那就是关于我们的伪分形求和。正弦函数并非每一项基础函数的唯一选择。要是我们尝试一些其他周期函数会怎样呢？嗯，如果我们在求和中保持项数较少，并且局限在一两个倍频程内，基础函数的特性就会在最终结果中体现出来。 

![2505051750 ](https://blogimgbeg.oss-cn-shanghai.aliyuncs.com/2025/05/05/1mg/2505051750-.png)
*2-D frequency synthesis with different periodic functions for the individual terms. 
1.sin, 2.abs of sin, 3.square waves 4.negative abs of sin.
These examples span only one octave and have no fractal character.*

当我们不使用正弦函数时，总和在形式上不再是带限的，但就其视觉特征大小而言，它仍然有一个清晰的 “尺度”，并且如果任何组件出现问题并导致混叠，我们可以直接控制细节。实际上，对于方波示例，对每一项都使用了aastep来获得更好看的图案。如果我们对大量的项进行求和，并让它们跨越几个倍频程，这些模式变化就会失去其独特的特征，或多或少呈现出与使用正弦函数时相同的样子。这可以为我们节省一些工作量，因为像三角波这样简单的周期函数比三角函数计算起来更省力。然而，我们仍然需要对数百项进行求和才能创建出类似分形的模式，而且目前有更好的方法来实现相同的目标——最值得注意的是后续章节中介绍的那些方法。 

